{% extends 'mapBase.html' %}
{% load static %}
{% block content %}
<script>

    function initMap() {
        let autocomplete;
        // Define your Google Maps initialization logic here
        var mapOptions = {
            center: {lat: 38.0336, lng: -78.5080},
            zoom: 15,
            styles: [
                {
                    featureType: 'poi',
                    stylers: [
                        { visibility: 'off' }
                    ]
                }
            ]
        };

                // Create the search box and link it to the UI element


        var map = new google.maps.Map(document.getElementById('map'), mapOptions);

        var input = document.getElementById('search-input');
    if (!input) {
        console.error('Search input not found.');
        return;
    }

    autocomplete = new google.maps.places.Autocomplete(input);
    autocomplete.bindTo('bounds', map);

    // Add listener when the user selects a place
    autocomplete.addListener('place_changed', function () {
        var place = autocomplete.getPlace();
        if (!place.geometry) {
            window.alert("No details available for input: '" + place.name + "'");
            return;
        }

        // If the place has a geometry, then present it on the map
        if (place.geometry.viewport) {
            map.fitBounds(place.geometry.viewport);
        } else {
            map.setCenter(place.geometry.location);
            map.setZoom(15); // Default zoom for searched location
        }

        // Optional: Add a marker to the searched location
        new google.maps.Marker({
            position: place.geometry.location,
            map: map,
            title: place.name
        });
    });

        // Assuming you have your locations data available in `data`
        data.locations.forEach(function(location) {
            var marker = new google.maps.Marker({
                position: { lat: parseFloat(location.lat), lng: parseFloat(location.long) },
                map: map,
                title: location.name
            });

            // Optionally, you can add an info window to display additional information
            var infoWindow = new google.maps.InfoWindow({
                content: `<h3>${location.name}</h3>`
            });

            marker.addListener('click', function() {
                infoWindow.open(map, marker);
            });
        });
    }
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyABHMSzBkIlURtKlubDpx6QDLzfmBtmYbE&callback=initMap&libraries=places">  <!-- Use the key variable here -->
</script>

<style>
    #map {
        height: 60%;  /* Fixed height, adjust as necessary */
        width: 100%;     /* Width as a percentage of the container */
        margin: 0 auto; /* Center the map horizontally */
    }

    /* Media query for responsiveness */
    @media (max-width: 768px) {
        #map {
            width: 100%;  /* On smaller screens, make the map full width */
            height: 300px; /* Smaller height for smaller screens */
        }
    }

    @media (max-width: 480px) {
        #map {
            height: 250px; /* Even smaller height for very small screens */
        }
    }
</style>

<div class="linkholder">
<center><input id="search-input" type="text" placeholder="Search for grocery stores" style="width: 500px; padding: 8px; margin-bottom: 10px;"></center>
    <div class="mapholder">
        <div id="map"></div>
    </div>
</div>

{% endblock %}
